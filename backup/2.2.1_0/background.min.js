class Config{escape(e){return e.replace(/[\?]/g,"\\$&")}constructor(e){let{URL:r,frameElement:t}=e;try{let e=Storage.getItem("configs");for(let t in e){let c=e[t];if(c&&"object"==typeof c&&!Array.isArray(c)&&c.enable&&c.url&&(c.url==r||new RegExp(this.escape(c.url)).test(r)||-1!==r.indexOf(c.url)))return chrome.browserAction.setIcon({path:"assets/icons/icon64.png"}),Promise.resolve(c)}}catch(e){Logger.error(e)}return t||chrome.browserAction.setIcon({path:"assets/icons/icon_black64.png"}),Logger.log(`No Records Found ${r}`),Promise.resolve()}checkLicense(e){return this.checkPRO(e)?paymentService.subscription()?e:(chrome.browserAction.setIcon({path:"assets/icons/icon_black64.png"}),chrome.browserAction.setTitle({title:"Your Auto Click PRO License is expired"}),{expired:!0}):e}checkPRO(e){let r=!1;return["initWait","repeat","repeatInterval","startTime"].forEach(t=>{e[t]&&(r=!0)}),e.actions.forEach(e=>{["initWait","repeat","repeatInterval"].forEach(t=>{e[t]&&(r=!0)})}),r}}
var messageListener=function(e){return e||function(){}}(messageListener);function updateConfig(e,n){for(index in e)if(Array.isArray(e[index])){let t=e[index];for(index in n=n[index],t){let e=t[index],i=n.findIndex(n=>n.xpath===e.xpath);-1===i?n.push(e):updateConfig(e,n[i])}}else"object"==typeof e[index]?(n[index]||(n[index]={}),updateConfig(e[index],n[index])):n[index]=e[index]}messageListener.prototype.setxPathAndURL=((e,n,t)=>{localStorage.url=e.url,localStorage.xpath=e.xpath,t(!0)}),messageListener.prototype.addUpdateConfig=((e,n,t)=>{let i=e.config,a=Storage.getItem("configs"),d=a.findIndex(e=>e.url===i.url);if(-1===d)i.enable=!0,a.push(i);else{let e=a[d];updateConfig(i,e),a[d]=e}Storage.setItem("configs",a),t(!0)});
if(!chrome.runtime.getManifest().config.uninstall_url)throw new Error("uninstall_url is not defined manifesto");chrome.runtime.setUninstallURL(chrome.runtime.getManifest().config.uninstall_url);
if(!chrome.browserAction)throw new Error("chrome.browserAction not defined in manifesto");chrome.browserAction.onClicked.addListener(()=>{Tab.getInst().openOptionsPage()});
let cipher=(r=>{if(!r)throw new Error("Salt key is not provided");let e=r=>r.split("").map(r=>r.charCodeAt(0)),t=r=>("0"+Number(r).toString(16)).substr(-2),i=t=>e(r).reduce((r,e)=>r^e,t);return r=>{if("string"!=typeof r)throw new Error("Passed parameter is not string");return r.split("").map(e).map(i).map(t).join("")}})(chrome.runtime.getManifest().key),decipher=(r=>{if(!r)throw new Error("Salt key is not provided");let e=(r=>r.split("").map(r=>r.charCodeAt(0)))(r),t=r=>e.reduce((r,e)=>r^e,r);return r=>{if("string"!=typeof r)throw new Error("Passed parameter is not string");return r.match(/.{1,2}/g).map(r=>parseInt(r,16)).map(t).map(r=>String.fromCharCode(r)).join("")}})(chrome.runtime.getManifest().key);
const LOCAL_STORAGE={RATE_DATE:"rateDate",TOKEN:"token",SETTINGS:"settings",INSTALL_DATE:"installDate"},ACTION={LOCAL_STORAGE:"localStorage",NOTIFICATION:"notif",BUY:"buy",SKU_DETAILS:"skuDetails",GET_PURCHASES:"getPurchases",GET_MANUAL_REGISTRATION:"getManualRegistration",SUBSCRIPTION:"subscription",CONSUME_PURCHASE:"consumePurchase",CONFIG:"config",CHROME_MANIFEST:"chrome.manifest",ERROR:"error",GOOGLE_ANALYSTICS:"ga",PAGE_VIEW:"pageView",EXPORT:"export"};
document.addEventListener("DOMContentLoaded",()=>{chrome.contextMenus.create({id:"xpath-selection",title:chrome.runtime.getManifest().name,contexts:["all"]})},!1),chrome.contextMenus.onClicked.addListener(e=>{"xpath-selection"===e.menuItemId&&(Tab.getInst().openOptionsPage({xpath:localStorage.xpath,url:localStorage.url}),localStorage.removeItem("xpath"),localStorage.removeItem("url"))});
var _gaq=_gaq||[];if(!chrome.runtime.getManifest().config.tracking_id)throw new Error("tracking_id is not defined in manifest.json");_gaq.push(["_setAccount",chrome.runtime.getManifest().config.tracking_id]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://ssl.google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();
if(!chrome.runtime.getManifest().browser_action||!chrome.runtime.getManifest().browser_action.default_icon)throw new Error("default icon is not defined in browser_action in manifest");if(!chrome.notifications)throw new Error("Notification permission is not provided");const DEFAULT_NOTIFICATION_OPTIONS={type:"basic",iconUrl:chrome.runtime.getManifest().browser_action.default_icon,title:chrome.runtime.getManifest().name};class Notification{constructor(){this.data=["0","1"]}static getInst(){return this.inst||(this.inst=new Notification)}create(t,i,e,o){let n=Storage.getItem(LOCAL_STORAGE.SETTINGS,{notifications:!0}).notifications;if(e||n){let e=this.data.length.toString(),n=this.getNotificationOptions(t);chrome.notifications.create(e,n,()=>{t.callback=i,t.extras=o,this.data.push(t)})}}getNotificationData(t){return this.data[t]}getNotificationOptions(t){return{...DEFAULT_NOTIFICATION_OPTIONS,...t}}}chrome.notifications.onClicked.addListener(t=>{let{extras:i}=Notification.getInst().getNotificationData(t);i&&i.url&&Tab.getInst().create(i.url,i.query),chrome.notifications.clear(t)}),chrome.notifications.onButtonClicked.addListener((t,i)=>{let{callback:e}=Notification.getInst().getNotificationData(t);e(t,i)});
chrome.runtime.onInstalled.addListener(()=>{Storage.getItem(LOCAL_STORAGE.INSTALL_DATE,null)||Storage.setItem(LOCAL_STORAGE.INSTALL_DATE,DateUtil.getCurrentDate().toJSON()),null==Storage.getItem("configs",null)?Rest.ajax("configs").then(e=>{Tab.getInst().openOptionsPage()}).catch(console.error):Tab.getInst().openOptionsPage()});
var messageListener=function(e){return e||function(){}}(messageListener);function getManifestValue(e){let t=chrome.runtime.getManifest(),s=e.split(".");for(index in s){t=t[s[index]]}return t}messageListener.prototype[ACTION.LOCAL_STORAGE]=((e,t,s)=>{"GET"===e.type?s(Storage.getItem(e.key,e.fallback)):"SET"===e.type?s(Storage.setItem(e.key,e.value)):s(Storage.removeItem(e.key))}),messageListener.prototype[ACTION.CONFIG]=((e,t,s)=>{new Config(e).then(s).catch(s)}),messageListener.prototype[ACTION.NOTIFICATION]=((e,t,s)=>{Notification.getInst().create(e.options,e.callback,e.important,e.extras),s(!0)}),messageListener.prototype[ACTION.SUBSCRIPTION]=((e,t,s)=>{s(paymentService.subscription())}),messageListener.prototype[ACTION.BUY]=((e,t,s)=>{paymentService.buy(e.sku).then(s).catch(s)}),messageListener.prototype[ACTION.SKU_DETAILS]=((e,t,s)=>{paymentService.skuDetails().then(s).catch(s)}),messageListener.prototype[ACTION.GET_PURCHASES]=((e,t,s)=>{paymentService.getPurchases().then(s).catch(s)}),messageListener.prototype[ACTION.CONSUME_PURCHASE]=((e,t,s)=>{paymentService.consumePurchase(e.sku).then(s).catch(s)}),messageListener.prototype[ACTION.GET_MANUAL_REGISTRATION]=((e,t,s)=>{paymentService.getManualRegistration().then(s).catch(s)}),messageListener.prototype[ACTION.ERROR]=((e,t,s)=>{_gaq.push(["_trackEvent",`${e.page}`,`${JSON.stringify(e.error)}`]),s(!0)}),messageListener.prototype[ACTION.PAGE_VIEW]=((e,t,s)=>{_gaq.push(["_trackPageview",`${e.page}`]),s(!0)}),messageListener.prototype[ACTION.GOOGLE_ANALYSTICS]=((e,t,s)=>{_gaq.push(["_trackEvent",`${paymentService.userInformation().email}`,`${getToken()}`]),s(!0)}),messageListener.prototype[ACTION.CHROME_MANIFEST]=((e,t,s)=>{let n;if(Array.isArray(e.key))for(index in n={},e.key)n[e.key[index]]=getManifestValue(e.key[index]);else n=getManifestValue(e.key);s(n)}),messageListener.prototype[ACTION.EXPORT]=((e,t,s)=>{const{filename:n,data:r}=e;if(n&&r){var a="data:application/json;base64,"+btoa(r);window.chrome.downloads.download({url:a,filename:`${n}.json`}),s(!0)}else s({error:`filename:${n} or data:${r} is missing`})});let messageListenerProtoType=new messageListener,listener=function(e,t,s){try{"function"==typeof messageListenerProtoType[e.action]?messageListenerProtoType[e.action](e,t,s):s(`${e.action} ${chrome.i18n.getMessage("message_action_not_found")}`)}catch(e){Logger.error(e)}return!0};chrome.runtime.onMessage.addListener(listener),chrome.runtime.onMessageExternal.addListener(listener);
chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()});
const STATE={ACTIVE:"ACTIVE",ERROR:"ERROR",FOUND:"FOUND",NOT_FOUND:"NOT_FOUND"},UNKNOWN_ERROR_TYPE='There was an error. Please try again. (Error type: " + a.response.errorType + ")',ERROR_TYPE={SKU_DETAILS:{INVALID_RESPONSE_ERROR:"There was an error in retrieving product details. Please make sure that Chrome Web Store Payments supports your region and try again."},GET_PURCHASES:{INVALID_RESPONSE_ERROR:"There was an error while getting your licenses. Please try again later."},CONSUME_PURCHASES:{INVALID_RESPONSE_ERROR:"There was an error while unsubscribing. Please try again or cancel subscription from Google Pay Center."},BUY:{INVALID_RESPONSE_ERROR:"There was an error while subscribing. Please try again later."},PURCHASE_CANCELED:"Purchase cancelled.",TOKEN_MISSING_ERROR:"Chrome sign-in required. Go to the Chrome settings page and under 'Sign In', click 'Sign in to Chrome'."},KEY="reg_key";var paymentService=function(){let e,r,t;function s(){n(),chrome.identity.getProfileUserInfo(a)}function a(e){t=e;let s=localStorage.getItem(KEY);if(s){let[t,a,n]=decipher(s).split("~");if(t===e.email&&a===e.id){if(new Date(n).getTime()>=DateUtil.getCurrentDate().getTime())return r={state:STATE.ACTIVE,email:t,id:a,date:n};localStorage.removeItem(KEY)}}return null}function n(){return new Promise((r,t)=>{google.payments.inapp.getPurchases({parameters:{env:"prod"},success:function(t){0!==(e=t.response.details.filter(e=>e.state===STATE.ACTIVE)).length?r({state:STATE.FOUND,purchases:e}):r({state:STATE.NOT_FOUND,message:chrome.i18n.getMessage("no_purchase_found")})},failure:e=>{console.error(e),_gaq.push(["_trackEvent","get_purchases_error",JSON.stringify(e)]);let{errorType:r}=e.response;t({state:STATE.ERROR,message:ERROR_TYPE[r]||ERROR_TYPE.GET_PURCHASES[r]||"There was an error. Please try again. (Error type: "+e.response.errorType+")"})}})})}return window.addEventListener("online",s),setTimeout(s,100),{subscription:()=>0!==e.length?e:r,getPurchases:n,getManualRegistration:function(){return new Promise((e,t)=>{chrome.identity.getProfileUserInfo(s=>{try{let r=a(s);if(r)return void e(r)}catch(e){_gaq.push(["_trackEvent","registration_error","chipher is INVALID"]),localStorage.removeItem(KEY)}Rest.ajax("manual_reg",!0).then(t=>{let a=t.filter(e=>new Date(e.date).getTime()>=DateUtil.getCurrentDate().getTime()).filter(e=>e.email===s.email);0!==a.length?(localStorage.setItem(KEY,cipher(`${s.email}~${s.id}~${a[0].date}`)),r={state:STATE.ACTIVE,email:s.email,id:s.id,date:a[0].date},e(r)):e({state:STATE.NOT_FOUND,message:chrome.i18n.getMessage("no_reg_found")})}).catch(e=>{console.error(e),_gaq.push(["_trackEvent","registration_error",JSON.stringify(e)]),t({state:STATE.ERROR,message:chrome.i18n.getMessage("register_server_error")})})})})},skuDetails:function(){return new Promise((e,r)=>{google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:function(r){let t=r.response.details.inAppProducts.filter(e=>e.state===STATE.ACTIVE);0!==t.length?e({state:STATE.FOUND,inAppProducts:t}):e({state:STATE.NOT_FOUND,message:chrome.i18n.getMessage("no_sku_found")})},failure:e=>{console.error(e),_gaq.push(["_trackEvent","get_sku_details_error",JSON.stringify(e)]);let{errorType:t}=e.response;r({state:STATE.ERROR,message:ERROR_TYPE[t]||ERROR_TYPE.SKU_DETAILS[t]||"There was an error. Please try again. (Error type: "+e.response.errorType+")"})}})})},consumePurchase:function(r){return new Promise((t,s)=>{google.payments.inapp.consumePurchase({parameters:{env:"prod"},sku:r||chrome.runtime.getManifest().config.sku,success:r=>{e=e.filter(e=>e.sku===r.response.details[0].sku),t({state:STATE.ACTIVE,result:r})},failure:e=>{let{errorType:r}=e.response;s({state:STATE.ERROR,message:ERROR_TYPE[r]||ERROR_TYPE.CONSUME_PURCHASES[r]||"There was an error. Please try again. (Error type: "+e.response.errorType+")"})}})})},userInformation:()=>t,buy:function(e){return new Promise((r,t)=>{google.payments.inapp.buy({parameters:{env:"prod"},sku:e||chrome.runtime.getManifest().config.sku,success:t=>{t.sku=e||chrome.runtime.getManifest().config.sku,r({state:STATE.ACTIVE,result:t})},failure:e=>{let{errorType:r}=e.response;t({state:STATE.ERROR,message:ERROR_TYPE[r]||ERROR_TYPE.BUY[r]||"There was an error. Please try again. (Error type: "+e.response.errorType+")"})}})})}}}();
const REVIEW_URL=chrome.runtime.getManifest().config.review_url,DEFAULT_RATE_DATA={count:3,date:DateUtil.getCurrentDate().toJSON(),show:!0},RATE_NOTIFICATION_OPTIONS={title:chrome.i18n.getMessage("rate_title"),message:chrome.i18n.getMessage("rate_message"),requireInteraction:!0,isClickable:!0,buttons:[{title:chrome.i18n.getMessage("rate_yes_button")},{title:chrome.i18n.getMessage("rate_no_button")}],url:REVIEW_URL,important:!0};class Rate{constructor(){this.storage=Storage.getItem(LOCAL_STORAGE.RATE_DATA,DEFAULT_RATE_DATA),this.installDate=Storage.getItem(LOCAL_STORAGE.INSTALL_DATE),this.installDate.setDate(this.installDate.getDate()+5)}static getInst(){return this.inst||(this.inst=new Rate)}check(){this.installDate.getTime()>DateUtil.getCurrentDate().getTime()&&this.storage.show&&(3==this.storage.count||new Date(this.storage.date).getTime()<DateUtil.getCurrentDate().getTime())&&this.show()}rated(){Tab.getInst().create(REVIEW_URL),this.storage.show=!1}later(){this.storage.count--,this.storage.date=this.currentDate.toJSON()}onClick(t,e){0==e?this.rated():this.later(),Storage.setItem(LOCAL_STORAGE.RATE,this.storage),chrome.notifications.clear(t)}show(){Notification.getInst().create(RATE_NOTIFICATION_OPTIONS,this.onClick.bind(this))}}
const OPTIONS_PAGE_URL=chrome.runtime.getManifest().config.options_page_url,OPTIONS_PAGE_TAB_ID="optionPageTabId";class Tab{constructor(){chrome.tabs.onRemoved.addListener(this.onRemoved.bind(this))}static getInst(){return this.inst||(this.inst=new Tab)}onRemoved(t){t===this[OPTIONS_PAGE_TAB_ID]&&(this[OPTIONS_PAGE_TAB_ID]=void 0)}openOptionsPage(t){let e=this.getURL(OPTIONS_PAGE_URL,t);this[OPTIONS_PAGE_TAB_ID]?this.update(this[OPTIONS_PAGE_TAB_ID],{active:!0,url:e}):this.create(e,null,t=>this[OPTIONS_PAGE_TAB_ID]=t.id)}getURL(t,e){if(e){t+="?";for(let i in e)t+=`&${i}=${encodeURIComponent(e[i])}`}return t}update(t,e){chrome.tabs.update(t,e)}create(t,e,i){t=this.getURL(t,e),chrome.tabs.create({url:t},i)}}
function getRandomToken(){var t=new Uint8Array(32);crypto.getRandomValues(t);for(var e="",n=0;n<t.length;++n)e+=t[n].toString(16);return localStorage.setItem(LOCAL_STORAGE.TOKEN,e),e}function getToken(){return localStorage.getItem(LOCAL_STORAGE.TOKEN)||getRandomToken()}